{"version":3,"file":"rum-maker.js","sources":["../src/index.js"],"sourcesContent":["console.log('@rumMaker index')\n\n//import * as babel from '@babel/core'\nimport fs from 'fs'\nimport * as rollup from 'rollup'\nimport babel from 'rollup-plugin-babel'\nimport commonjs from 'rollup-plugin-commonjs'\nimport resolve from 'rollup-plugin-node-resolve'\n\nconst pkg = JSON.parse(fs.readFileSync('./package.json', \"utf8\"))\nconst DEFAULTS = {\n  entry: 'src/index.js',\n}\nconst opts = Object.assign({}, DEFAULTS)\nif (pkg.rum && pkg.rum.maker) Object.assign(opts, pkg.rum.maker)\nconst filename = opts.entry\n\nlet external = []\nif (pkg.devDependencies) external.push(...Object.keys(pkg.devDependencies))\nif (pkg.dependencies) external.push(...Object.keys(pkg.dependencies))\nconst jobs = [\n  {\n    in:{\n      input: filename,\n      external,\n      plugins: [\n        babel({\n          presets: [\n            \"@babel/preset-env\"\n          ],\n          babelrc: false,\n          configFile: false,\n          externalHelpers: false,\n          runtimeHelpers: true,\n          sourceMaps: true\n        }),\n        resolve({\n          preferBuiltins: true\n        }),\n        commonjs()\n      ]\n    },\n    out: [\n      {\n        file: pkg.main,\n        format: 'cjs',\n        sourcemap: true,\n      },\n      {\n        file: pkg.module,\n        format: 'es',\n        sourcemap: true,\n      }\n    ]\n  },\n  {\n    in:{\n      input: filename,\n      external: external,\n      plugins: [\n        babel({\n          presets: [\n            \"@babel/preset-env\"\n          ],\n          babelrc: false,\n          configFile: false,\n          externalHelpers: false,\n          runtimeHelpers: true,\n          sourceMaps: true\n        }),\n        resolve({\n          browser: true\n        }),\n        commonjs()\n      ]\n    },\n    out: [\n      {\n        file: pkg.browser,\n        format: 'cjs',\n        sourcemap: true,\n      }\n    ]\n  }\n\n]\n\n\n\nfunction build() {\n  // create a bundle\n  jobs.forEach((job) => {\n    rollup.rollup(job.in).then(bundle=>{\n      //console.log(bundle.imports); // an array of external dependencies\n      //console.log(bundle.exports); // an array of names exported by the entry point\n      //console.log(bundle.modules); // an array of module objects\n\n        console.log(bundle)\n      job.out.forEach((out) => {\n        bundle.generate(out).then((gen)=>{\n        //  console.log(gen)\n          if (out.file) bundle.write(out);\n        })\n      })\n    })\n  })\n    // generate code and a sourcemap\n    //const { code, map } = await\n\n  //})\n\n\n  // or write the bundle to disk\n  //await\n}\n\nbuild();\n\n\n/*\n//console.log(code)\n// Load and compile file normally, but skip code generation.\nconst { ast } = babel.transformSync(code, { filename, ast: true,\npresets: [\"@babel/preset-env\"], code: false });\nconsole.log(ast)\n// Minify the file in a second pass and generate the output code here.\nconst { code2, map } = babel.transformFromAstSync(ast, code, {\n  filename,\n  presets: [\"@babel/preset-env\"],\n  babelrc: false,\n  configFile: false,\n});\nconsole.log(code2)\n*/\n"],"names":["console","log","pkg","JSON","parse","fs","readFileSync","DEFAULTS","entry","opts","Object","assign","rum","maker","filename","external","devDependencies","push","keys","dependencies","jobs","in","input","plugins","babel","presets","babelrc","configFile","externalHelpers","runtimeHelpers","sourceMaps","resolve","preferBuiltins","commonjs","out","file","main","format","sourcemap","module","browser","build","forEach","job","rollup","then","bundle","generate","gen","write"],"mappings":"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"}